<div class="domain-settings-container">
  <div class="section-header">
    <h2>üåê Dom√≠nios Personalizados</h2>
    <p class="section-description">
      Configure dom√≠nios personalizados para o site da sua imobili√°ria
    </p>
  </div>

  <!-- Add Domain Button -->
  <div class="action-bar" *ngIf="authService.isAdmin()">
    <button class="btn-primary" (click)="showAddDomainForm = true">
      ‚ûï Adicionar Dom√≠nio
    </button>
  </div>

  <!-- Add Domain Form -->
  <div class="modal-overlay" *ngIf="showAddDomainForm" (click)="showAddDomainForm = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Adicionar Novo Dom√≠nio</h3>
      <form (ngSubmit)="addDomain()">
        <div class="form-group">
          <label>Dom√≠nio *</label>
          <input type="text" 
                 [(ngModel)]="newDomain.domain" 
                 name="domain" 
                 placeholder="exemplo: minhaimobiliaria.com.br"
                 required>
          <small class="form-hint">Digite o dom√≠nio completo (ex: meusite.com.br)</small>
        </div>
        
        <div class="form-group">
          <label>Subdom√≠nio (opcional)</label>
          <input type="text" 
                 [(ngModel)]="newDomain.subdomain" 
                 name="subdomain" 
                 placeholder="ex: www">
          <small class="form-hint">Deixe em branco se n√£o usar subdom√≠nio</small>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="showAddDomainForm = false">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="saving">
            {{ saving ? 'Adicionando...' : 'Adicionar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- DNS Instructions Modal -->
  <div class="modal-overlay" *ngIf="dnsInstructions" (click)="closeDnsInstructions()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <h3>üìã Configura√ß√£o DNS</h3>
      <p>Configure os seguintes registros DNS no seu provedor de dom√≠nio:</p>
      
      <div class="dns-records">
        <div class="dns-record" *ngFor="let record of dnsInstructions.dns_records">
          <div class="record-header">
            <span class="record-type">{{ record.type }}</span>
            <button class="btn-copy" (click)="copyToClipboard(record.value)" title="Copiar valor">
              üìã
            </button>
          </div>
          <div class="record-details">
            <div class="record-field">
              <strong>Host:</strong>
              <code>{{ record.host }}</code>
            </div>
            <div class="record-field">
              <strong>Valor:</strong>
              <code>{{ record.value }}</code>
            </div>
            <div class="record-field">
              <strong>TTL:</strong>
              <code>{{ record.ttl }}</code>
            </div>
          </div>
        </div>
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è Informa√ß√µes Importantes:</strong>
        <ul>
          <li>A propaga√ß√£o DNS pode levar de 1 a 48 horas</li>
          <li>Ap√≥s configurar o DNS, adicione o dom√≠nio no painel do Netlify/Vercel</li>
          <li>O SSL ser√° configurado automaticamente pela plataforma</li>
          <li>Ap√≥s configura√ß√£o completa, clique em "Verificar" e depois "Ativar"</li>
        </ul>
      </div>

      <div class="form-actions">
        <button class="btn-primary" (click)="closeDnsInstructions()">
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Domains List -->
  <div class="domains-list" *ngIf="!loading">
    <div class="empty-state" *ngIf="domains.length === 0">
      <div class="empty-icon">üåê</div>
      <h3>Nenhum Dom√≠nio Cadastrado</h3>
      <p>Adicione um dom√≠nio personalizado para usar no site da sua imobili√°ria</p>
    </div>

    <div class="domain-card" *ngFor="let domain of domains">
      <div class="domain-header">
        <div class="domain-info">
          <h3>{{ domain.domain }}</h3>
          <div class="domain-badges">
            <span class="badge" [class]="'badge-' + domain.status">
              {{ getStatusIcon(domain.status) }} {{ getStatusLabel(domain.status) }}
            </span>
            <span class="badge badge-primary" *ngIf="domain.is_primary">
              ‚≠ê Principal
            </span>
            <span class="badge badge-info" *ngIf="domain.is_subdomain_auto">
              üöÄ Subdom√≠nio Autom√°tico
            </span>
            <span class="badge badge-success" *ngIf="domain.status === 'active'">
              üîí SSL Autom√°tico
            </span>
          </div>
        </div>
        
        <div class="domain-actions" *ngIf="authService.isAdmin()">
          <button class="btn-icon" 
                  *ngIf="!domain.is_subdomain_auto"
                  (click)="showDnsInstructions(domain)" 
                  title="Ver configura√ß√µes DNS">
            üìã
          </button>
          
          <button class="btn-icon" 
                  *ngIf="domain.status === 'pending' && !domain.is_subdomain_auto"
                  (click)="verifyDomain(domain)" 
                  title="Marcar como verificado">
            ‚úÖ
          </button>
          
          <button class="btn-icon" 
                  *ngIf="domain.status === 'verified'"
                  (click)="activateDomain(domain)" 
                  title="Ativar dom√≠nio">
            üöÄ
          </button>
          
          <button class="btn-icon" 
                  *ngIf="!domain.is_primary && domain.status === 'active'"
                  (click)="setPrimary(domain)" 
                  title="Definir como principal">
            ‚≠ê
          </button>
          
          <button class="btn-icon btn-danger" 
                  (click)="deleteDomain(domain)" 
                  title="Remover dom√≠nio">
            üóëÔ∏è
          </button>
        </div>
      </div>

      <div class="domain-details">
        <div class="detail-item" *ngIf="domain.subdomain">
          <strong>Subdom√≠nio:</strong>
          <span>{{ domain.subdomain }}</span>
        </div>

        <div class="detail-item" *ngIf="domain.is_subdomain_auto">
          <strong>Tipo:</strong>
          <span>Subdom√≠nio autom√°tico (SSL inclu√≠do)</span>
        </div>
        
        <div class="detail-item" *ngIf="domain.verified_at">
          <strong>Verificado em:</strong>
          <span>{{ domain.verified_at | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>

        <div class="detail-item">
          <strong>Criado em:</strong>
          <span>{{ domain.created_at | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>

      <!-- Status Message -->
      <div class="status-message" *ngIf="domain.status === 'pending' && !domain.is_subdomain_auto">
        <span class="warning-icon">‚ö†Ô∏è</span>
        <p>Configure os registros DNS no seu provedor e adicione o dom√≠nio no painel do Netlify/Vercel. Depois clique em "Verificar".</p>
      </div>

      <div class="status-message success" *ngIf="domain.status === 'verified'">
        <span class="success-icon">‚úÖ</span>
        <p>Dom√≠nio verificado! Confirme que foi adicionado no Netlify/Vercel e clique em "Ativar".</p>
      </div>

      <div class="status-message success" *ngIf="domain.status === 'active' && domain.is_subdomain_auto">
        <span class="success-icon">üéâ</span>
        <p>Subdom√≠nio autom√°tico ativo! Seu site est√° acess√≠vel em <strong>{{ domain.domain }}</strong> com SSL autom√°tico.</p>
      </div>

      <div class="status-message success" *ngIf="domain.status === 'active' && !domain.is_subdomain_auto">
        <span class="success-icon">üéâ</span>
        <p>Dom√≠nio customizado ativo! Seu site est√° acess√≠vel em <strong>{{ domain.domain }}</strong> com SSL fornecido pelo Netlify/Vercel.</p>
      </div>

      <div class="status-message error" *ngIf="domain.status === 'failed'">
        <span class="error-icon">‚ùå</span>
        <p>Falha na configura√ß√£o. Verifique as configura√ß√µes DNS e se o dom√≠nio foi adicionado no Netlify/Vercel.</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Carregando dom√≠nios...</p>
  </div>

  <!-- Info Section -->
  <div class="info-section" *ngIf="!authService.isAdmin()">
    <div class="alert-warning">
      <span class="warning-icon">‚ö†Ô∏è</span>
      <strong>Acesso Restrito:</strong> Apenas administradores podem gerenciar dom√≠nios personalizados.
    </div>
  </div>

  <!-- Help Section -->
  <div class="help-section">
    <h3>‚ùì Como funciona?</h3>
    
    <h4>üöÄ Op√ß√£o 1: Subdom√≠nio Autom√°tico (Recomendado para iniciar)</h4>
    <p><strong>Formato:</strong> <code>suaempresa.seusite.com</code></p>
    <ul>
      <li>‚úÖ SSL autom√°tico inclu√≠do</li>
      <li>‚úÖ Zero configura√ß√£o necess√°ria</li>
      <li>‚úÖ Ativo imediatamente</li>
      <li>‚úÖ Sem custos adicionais</li>
    </ul>
    
    <h4>üåê Op√ß√£o 2: Dom√≠nio Customizado (Premium)</h4>
    <p><strong>Formato:</strong> <code>www.suaempresa.com.br</code></p>
    <ol>
      <li>Adicione o dom√≠nio nesta interface</li>
      <li>Configure os registros DNS CNAME no seu provedor</li>
      <li>Adicione o dom√≠nio no painel do Netlify/Vercel</li>
      <li>Aguarde propaga√ß√£o DNS (1-48 horas)</li>
      <li>Clique em "Verificar" para confirmar configura√ß√£o</li>
      <li>Clique em "Ativar" para tornar o dom√≠nio ativo</li>
      <li>SSL ser√° configurado automaticamente pela plataforma</li>
    </ol>
    
    <h3>üîß Requisitos T√©cnicos</h3>
    <p><strong>Para dom√≠nios customizados:</strong></p>
    <ul>
      <li>Acesso ao painel do seu provedor de dom√≠nio (ex: Registro.br, GoDaddy)</li>
      <li>Permiss√£o para modificar registros DNS</li>
      <li>Conta no Netlify/Vercel (onde o site est√° hospedado)</li>
      <li>SSL √© configurado automaticamente pela plataforma de hospedagem</li>
    </ul>
    
    <div class="info-box">
      <strong>üí° Dica:</strong> Para come√ßar rapidamente, use o subdom√≠nio autom√°tico. Voc√™ pode adicionar um dom√≠nio customizado posteriormente como recurso premium.
    </div>
  </div>
</div>
