<div class="domain-settings-container">
  <div class="section-header">
    <h2>üåê Dom√≠nios Personalizados</h2>
    <p class="section-description">
      Configure dom√≠nios personalizados para o site da sua imobili√°ria
    </p>
  </div>

  <!-- Add Domain Button -->
  <div class="action-bar" *ngIf="authService.isAdmin()">
    <button class="btn-primary" (click)="showAddDomainForm = true">
      ‚ûï Adicionar Dom√≠nio
    </button>
  </div>

  <!-- Add Domain Form -->
  <div class="modal-overlay" *ngIf="showAddDomainForm" (click)="showAddDomainForm = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Adicionar Novo Dom√≠nio</h3>
      <form (ngSubmit)="addDomain()">
        <div class="form-group">
          <label>Dom√≠nio *</label>
          <input type="text" 
                 [(ngModel)]="newDomain.domain" 
                 name="domain" 
                 placeholder="exemplo: minhaimobiliaria.com.br"
                 required>
          <small class="form-hint">Digite o dom√≠nio completo (ex: meusite.com.br)</small>
        </div>
        
        <div class="form-group">
          <label>Subdom√≠nio (opcional)</label>
          <input type="text" 
                 [(ngModel)]="newDomain.subdomain" 
                 name="subdomain" 
                 placeholder="ex: www">
          <small class="form-hint">Deixe em branco se n√£o usar subdom√≠nio</small>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="showAddDomainForm = false">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="saving">
            {{ saving ? 'Adicionando...' : 'Adicionar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- DNS Instructions Modal -->
  <div class="modal-overlay" *ngIf="dnsInstructions" (click)="closeDnsInstructions()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <h3>üìã Configura√ß√£o DNS</h3>
      <p>Configure os seguintes registros DNS no seu provedor de dom√≠nio:</p>
      
      <div class="dns-records">
        <div class="dns-record" *ngFor="let record of dnsInstructions.dns_records">
          <div class="record-header">
            <span class="record-type">{{ record.type }}</span>
            <button class="btn-copy" (click)="copyToClipboard(record.value)" title="Copiar valor">
              üìã
            </button>
          </div>
          <div class="record-details">
            <div class="record-field">
              <strong>Host:</strong>
              <code>{{ record.host }}</code>
            </div>
            <div class="record-field">
              <strong>Valor:</strong>
              <code>{{ record.value }}</code>
            </div>
            <div class="record-field">
              <strong>TTL:</strong>
              <code>{{ record.ttl }}</code>
            </div>
          </div>
        </div>
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è Informa√ß√µes Importantes:</strong>
        <ul>
          <li>A propaga√ß√£o DNS pode levar de 1 a 48 horas</li>
          <li>Certifique-se de adicionar todos os registros DNS</li>
          <li>O registro TXT √© usado para verifica√ß√£o de propriedade do dom√≠nio</li>
          <li>Ap√≥s configurar o DNS, clique em "Verificar" para ativar o dom√≠nio</li>
        </ul>
      </div>

      <div class="form-actions">
        <button class="btn-primary" (click)="closeDnsInstructions()">
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Domains List -->
  <div class="domains-list" *ngIf="!loading">
    <div class="empty-state" *ngIf="domains.length === 0">
      <div class="empty-icon">üåê</div>
      <h3>Nenhum Dom√≠nio Cadastrado</h3>
      <p>Adicione um dom√≠nio personalizado para usar no site da sua imobili√°ria</p>
    </div>

    <div class="domain-card" *ngFor="let domain of domains">
      <div class="domain-header">
        <div class="domain-info">
          <h3>{{ domain.domain }}</h3>
          <div class="domain-badges">
            <span class="badge" [class]="'badge-' + domain.status">
              {{ getStatusIcon(domain.status) }} {{ getStatusLabel(domain.status) }}
            </span>
            <span class="badge badge-primary" *ngIf="domain.is_primary">
              ‚≠ê Principal
            </span>
            <span class="badge badge-success" *ngIf="domain.ssl_enabled">
              üîí SSL Ativo
            </span>
          </div>
        </div>
        
        <div class="domain-actions" *ngIf="authService.isAdmin()">
          <button class="btn-icon" 
                  (click)="showDnsInstructions(domain)" 
                  title="Ver configura√ß√µes DNS">
            üìã
          </button>
          
          <button class="btn-icon" 
                  *ngIf="domain.status === 'pending'"
                  (click)="verifyDomain(domain)" 
                  title="Verificar dom√≠nio">
            ‚úÖ
          </button>
          
          <button class="btn-icon" 
                  *ngIf="domain.status === 'verified' && !domain.ssl_enabled"
                  (click)="enableSSL(domain)" 
                  title="Habilitar SSL">
            üîí
          </button>
          
          <button class="btn-icon" 
                  *ngIf="!domain.is_primary && domain.status === 'active'"
                  (click)="setPrimary(domain)" 
                  title="Definir como principal">
            ‚≠ê
          </button>
          
          <button class="btn-icon btn-danger" 
                  (click)="deleteDomain(domain)" 
                  title="Remover dom√≠nio">
            üóëÔ∏è
          </button>
        </div>
      </div>

      <div class="domain-details">
        <div class="detail-item" *ngIf="domain.subdomain">
          <strong>Subdom√≠nio:</strong>
          <span>{{ domain.subdomain }}</span>
        </div>
        
        <div class="detail-item" *ngIf="domain.verified_at">
          <strong>Verificado em:</strong>
          <span>{{ domain.verified_at | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
        
        <div class="detail-item" *ngIf="domain.ssl_enabled && domain.ssl_expires_at">
          <strong>SSL expira em:</strong>
          <span>{{ domain.ssl_expires_at | date:'dd/MM/yyyy' }}</span>
        </div>

        <div class="detail-item">
          <strong>Criado em:</strong>
          <span>{{ domain.created_at | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>

      <!-- Status Message -->
      <div class="status-message" *ngIf="domain.status === 'pending'">
        <span class="warning-icon">‚ö†Ô∏è</span>
        <p>Configure os registros DNS e clique em "Verificar" para ativar o dom√≠nio.</p>
      </div>

      <div class="status-message success" *ngIf="domain.status === 'verified'">
        <span class="success-icon">‚úÖ</span>
        <p>Dom√≠nio verificado! Habilite o SSL para torn√°-lo ativo.</p>
      </div>

      <div class="status-message success" *ngIf="domain.status === 'active'">
        <span class="success-icon">üéâ</span>
        <p>Dom√≠nio ativo e funcionando! Seu site est√° acess√≠vel em <strong>{{ domain.domain }}</strong></p>
      </div>

      <div class="status-message error" *ngIf="domain.status === 'failed'">
        <span class="error-icon">‚ùå</span>
        <p>Falha na verifica√ß√£o. Verifique as configura√ß√µes DNS e tente novamente.</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Carregando dom√≠nios...</p>
  </div>

  <!-- Info Section -->
  <div class="info-section" *ngIf="!authService.isAdmin()">
    <div class="alert-warning">
      <span class="warning-icon">‚ö†Ô∏è</span>
      <strong>Acesso Restrito:</strong> Apenas administradores podem gerenciar dom√≠nios personalizados.
    </div>
  </div>

  <!-- Help Section -->
  <div class="help-section">
    <h3>‚ùì Como funciona?</h3>
    <ol>
      <li>Adicione seu dom√≠nio personalizado</li>
      <li>Configure os registros DNS no seu provedor (ex: Registro.br, GoDaddy)</li>
      <li>Aguarde a propaga√ß√£o DNS (1-48 horas)</li>
      <li>Clique em "Verificar" para validar o dom√≠nio</li>
      <li>Habilite o SSL para seguran√ßa (certificado autom√°tico)</li>
      <li>Defina como dom√≠nio principal se desejar</li>
    </ol>
    
    <h3>üîß Requisitos T√©cnicos</h3>
    <ul>
      <li>Acesso ao painel de controle do seu provedor de dom√≠nio</li>
      <li>Permiss√£o para modificar registros DNS</li>
      <li>Servidor com IP p√∫blico (fornecido pelo sistema)</li>
      <li>Certificado SSL ser√° gerado automaticamente via Let's Encrypt</li>
    </ul>
  </div>
</div>
