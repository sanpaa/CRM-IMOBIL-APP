<div class="builder-container" *ngIf="!loading">
  <!-- Top Bar -->
  <div class="builder-header">
    <button class="btn-ghost icon-btn" type="button" aria-label="Menu">â˜°</button>
    <div class="layout-selector" *ngIf="currentLayout">
      <select [(ngModel)]="currentLayout" (change)="selectLayout(currentLayout!)">
        <option *ngFor="let layout of layouts" [ngValue]="layout">
          {{ layout.name }}
          <span *ngIf="layout.is_default">(PadrÃ£o)</span>
        </option>
      </select>
    </div>
    <div class="status-pill" *ngIf="currentLayout">
      <span class="status-dot" [class.published]="currentLayout.is_default"></span>
      <span class="status-label">{{ currentLayout.is_default ? 'Publicado' : 'Rascunho' }}</span>
      <span class="status-divider"></span>
      <span class="status-state" *ngIf="saving">Salvando...</span>
      <span class="status-state" *ngIf="!saving && !hasUnsavedChanges && lastSavedAt">Salvo automaticamente</span>
      <span class="status-state" *ngIf="!saving && hasUnsavedChanges">AlteraÃ§Ãµes nÃ£o salvas</span>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="showLayoutForm = true">
        âž• Novo Layout
      </button>
      <button class="btn-primary" (click)="saveLayout()" [disabled]="saving || !currentLayout">
        ðŸ’¾ Salvar
      </button>
      <button class="btn-success" (click)="publishLayout()" [disabled]="!currentLayout">
        ðŸš€ Publicar
      </button>
    </div>
  </div>

  <!-- New Layout Form Modal -->
  <div class="modal-overlay" *ngIf="showLayoutForm" (click)="showLayoutForm = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Criar Novo Layout</h2>
      <form (ngSubmit)="createNewLayout()">
        <div class="form-group">
          <label>Nome do Layout *</label>
          <input type="text" [(ngModel)]="newLayoutData.name" name="name" required>
        </div>
        
        <div class="form-group">
          <label>Tipo de PÃ¡gina *</label>
          <select [(ngModel)]="newLayoutData.page_type" name="page_type" required>
            <option *ngFor="let type of pageTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
        </div>
        
        <div class="form-group" *ngIf="newLayoutData.page_type === 'custom'">
          <label>Slug (URL)</label>
          <input type="text" [(ngModel)]="newLayoutData.slug" name="slug" 
                 placeholder="ex: sobre-nos">
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="showLayoutForm = false">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="saving">
            {{ saving ? 'Criando...' : 'Criar Layout' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Main Content -->
  <div class="builder-content" *ngIf="currentLayout">
    <div class="canvas-area">
      <div class="canvas-header">
        <div class="canvas-title">
          <h3>{{ currentLayout.name }}</h3>
          <span class="page-type-badge">{{ currentLayout.page_type }}</span>
        </div>
      </div>
      <app-grapes-editor-host
        class="grapes-host"
        (contentChanged)="onEditorChange()">
      </app-grapes-editor-host>
    </div>
  </div>

  <!-- No Layout State -->
  <div class="no-layout-state" *ngIf="!currentLayout && layouts.length === 0">
    <div class="empty-icon">ðŸŽ¨</div>
    <h2>Nenhum Layout Encontrado</h2>
    <p>Crie seu primeiro layout para comeÃ§ar a personalizar seu site</p>
    <button class="btn-primary btn-large" (click)="showLayoutForm = true">
      âž• Criar Primeiro Layout
    </button>
  </div>
</div>

<div class="loading-state" *ngIf="loading">
  <div class="spinner"></div>
  <p>Carregando construtor de sites...</p>
</div>

