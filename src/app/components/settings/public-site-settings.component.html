<div class="page-container">
  <app-page-header
    title="Site simples"
    subtitle="Escolha um template, preencha os dados e publique">
    <a header-top class="btn-back" routerLink="/dashboard" aria-label="Voltar">
      <span class="btn-back-icon">←</span>
      <span>Voltar</span>
    </a>
  </app-page-header>

  <div class="settings-layout" *ngIf="!loading">
    <div class="settings-column">
      <details class="settings-accordion" open>
        <summary class="settings-accordion-title" (click)="onAccordionClick($event)">Templates</summary>
        <div class="accordion-body">
          <section class="settings-card settings-card-inner">
            <div class="template-tabs">
            <button
              type="button"
              class="template-tab"
              *ngFor="let group of templateGroups"
              [class.active]="group.id === selectedTemplateGroup"
              (click)="selectedTemplateGroup = group.id">
              {{ group.label }}
            </button>
          </div>
          <div class="template-grid">
            <label
              class="template-card"
              *ngFor="let item of filteredTemplates"
              [class.selected]="item.id === selectedTemplateId">
              <input
                type="radio"
                name="templateId"
                [value]="item.id"
                [(ngModel)]="selectedTemplateId"
                (ngModelChange)="onTemplateSelect($event)" />
              <div class="template-preview">
                <img *ngIf="item.preview" [src]="item.preview" [alt]="item.name" />
                <div class="placeholder" *ngIf="!item.preview">Preview</div>
              </div>
              <div class="template-info">
                <span class="template-name">{{ item.name }}</span>
                <span class="template-action">
                  {{ item.id === selectedTemplateId ? 'Selecionado' : 'Selecionar' }}
                </span>
              </div>
            </label>
          </div>
          </section>
        </div>
      </details>

      <details class="settings-accordion" open>
        <summary class="settings-accordion-title" (click)="onAccordionClick($event)">Dados da imobiliaria</summary>
        <div class="accordion-body">
          <section class="settings-card settings-card-inner">
            <div class="form-grid">
          <label class="field">
            <span>Nome da imobiliaria</span>
            <input type="text" [(ngModel)]="config.companyName" (ngModelChange)="scheduleSave()" />
          </label>

          <label class="field">
            <span>Logo (URL)</span>
            <input type="text" [(ngModel)]="config.logo" (ngModelChange)="scheduleSave()" placeholder="https://..." />
          </label>

          <label class="field">
            <span>Cor principal</span>
            <div class="color-row">
              <input type="color" [(ngModel)]="config.primaryColor" (ngModelChange)="scheduleSave()" />
              <input type="text" [(ngModel)]="config.primaryColor" (ngModelChange)="scheduleSave()" />
            </div>
          </label>

          <label class="field">
            <span>Cor secundaria</span>
            <div class="color-row">
              <input type="color" [(ngModel)]="config.secondaryColor" (ngModelChange)="scheduleSave()" />
              <input type="text" [(ngModel)]="config.secondaryColor" (ngModelChange)="scheduleSave()" />
            </div>
          </label>

          <label class="field">
            <span>Cor de destaque</span>
            <div class="color-row">
              <input type="color" [(ngModel)]="config.accentColor" (ngModelChange)="scheduleSave()" />
              <input type="text" [(ngModel)]="config.accentColor" (ngModelChange)="scheduleSave()" />
            </div>
          </label>

          <label class="field">
            <span>Cor de fundo</span>
            <div class="color-row">
              <input type="color" [(ngModel)]="config.backgroundColor" (ngModelChange)="scheduleSave()" />
              <input type="text" [(ngModel)]="config.backgroundColor" (ngModelChange)="scheduleSave()" />
            </div>
          </label>

          <label class="field">
            <span>WhatsApp</span>
            <input type="text" [(ngModel)]="config.whatsapp" (ngModelChange)="scheduleSave()" placeholder="5511999999999" />
          </label>

          <label class="field">
            <span>Instagram</span>
            <input type="text" [(ngModel)]="config.instagram" (ngModelChange)="scheduleSave()" placeholder="https://instagram.com/..." />
          </label>

          <label class="field">
            <span>Facebook</span>
            <input type="text" [(ngModel)]="config.facebook" (ngModelChange)="scheduleSave()" placeholder="https://facebook.com/..." />
          </label>

          <label class="field">
            <span>YouTube</span>
            <input type="text" [(ngModel)]="config.youtube" (ngModelChange)="scheduleSave()" placeholder="https://youtube.com/..." />
          </label>

          <label class="field">
            <span>LinkedIn</span>
            <input type="text" [(ngModel)]="config.linkedin" (ngModelChange)="scheduleSave()" placeholder="https://linkedin.com/..." />
          </label>

          <label class="field full">
            <span>Texto principal (Hero)</span>
            <input type="text" [(ngModel)]="config.heroTitle" (ngModelChange)="scheduleSave()" />
          </label>

          <label class="field full">
            <span>Subtitulo</span>
            <textarea rows="2" [(ngModel)]="config.heroText" (ngModelChange)="scheduleSave()"></textarea>
          </label>

          <label class="field full">
            <span>Sobre</span>
            <textarea rows="3" [(ngModel)]="config.aboutText" (ngModelChange)="scheduleSave()"></textarea>
          </label>

          <label class="field full">
            <span>Contato</span>
            <textarea rows="3" [(ngModel)]="config.contactText" (ngModelChange)="scheduleSave()"></textarea>
          </label>

          <label class="field">
            <span>Footer: Tag</span>
            <input type="text" [(ngModel)]="config.footerTagline" (ngModelChange)="scheduleSave()" placeholder="Institucional" />
          </label>

          <label class="field">
            <span>Footer: Titulo links</span>
            <input type="text" [(ngModel)]="config.footerLinksTitle" (ngModelChange)="scheduleSave()" placeholder="Institucional" />
          </label>

          <label class="field">
            <span>Footer: Badge</span>
            <input type="text" [(ngModel)]="config.footerBadge" (ngModelChange)="scheduleSave()" placeholder="Opcional" />
          </label>

          <label class="field full">
            <span>Footer: Texto</span>
            <textarea rows="2" [(ngModel)]="config.footerText" (ngModelChange)="scheduleSave()"></textarea>
          </label>
            </div>
          </section>
        </div>
      </details>

      <div class="actions">
        <button class="btn-primary" type="button" (click)="persist()" [disabled]="saving">
          {{ saving ? 'Salvando...' : 'Salvar agora' }}
        </button>
        <button class="btn-secondary" type="button" (click)="publish()" [disabled]="saving">
          Publicar
        </button>
        <span class="status" *ngIf="saved">Salvo automaticamente</span>
      </div>
    </div>

    <div class="preview-column">
      <div class="preview-shell">
        <div class="preview-header">
          <h3>Preview</h3>
          <span>Atualiza em tempo real</span>
        </div>
        <div class="preview-body">
          <app-site-preview [properties]="properties" [previewHtml]="previewHtml"></app-site-preview>
        </div>
      </div>
    </div>
  </div>

  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>
</div>
